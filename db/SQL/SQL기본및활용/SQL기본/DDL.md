# DDL

## 1. 데이터 유형

> 테이블에 특정 자료를 입력할 때, 그 자료를 받아들일 공간을 자료의 유형별로 나누는 기준
>
> 즉 특정 칼럼을 정의할 때 선언한 데이터 유형은 그 칼럼이 받아들일 수 있는 자료의 유형을 규정함

| 데이터 유형  | 설명                                                         |
| ------------ | ------------------------------------------------------------ |
| CHARACTER(s) | - 고정 길이 문자열 정보 (Oracle, SQL Server 모두 CHAR 로 표현)<br />- s 는 기본 길이 1바이트, 최대 길이 Oracle 2,000 바이트, SQL Server 8,000 바이트<br />- s 만큼 최대 길이를 갖고 고정 길이를 가지고 있으므로 할당된 변수 값의 길이가 s 보다 작을 경우에는 그 차이 길이만큼 공간으로 채워진다. |
| VARCHAR(s)   | - CHARACTER VARYING 의 약자로 가변 길이 문자열 정보 (Oracle 은 VARCHAR2 로 표현, SQL Server 는 VARCHAR 로 표현)<br />- s 는 최소 길이 1바이트, 최대 길이 Oracle 4,000 바이트, SQL Server 8,000 바이트<br />- s 만큼의ㅏ 최대 길이를 갖지만 가변 길이로 조정이 되기 때문에 할당된 변수값의 바이트만 적용된다. (Limit 개념) |
| NUMERIC      | - 정수, 실수 등 숫자 정보 (Oracle 은 NUMBER 로, SQL Server 는 10 가지 이상의 숫자 타입을 갖고 있음)<br />- Oracle 은 처음에 전체 자리 수를 지정하고, 그 다음 소수 부분의 자리 수를 지정한다. Ex) 정수 부분이 6 자리이고 소수점 부분이 2 자리인 경우에는 `NUMBER(8,2)` 와 같이 된다. |
| DATETIME     | - 날짜와 시각 정보 (Oracle 은 DATE 로 표현, SQL Server 는 DATETIME 으로 표현)<br />- Oracle 은 1초 단위, SQL Server 는 3.33ms(millisecond) 단위 관리 |

> 문자열의 경우 CHAR / VARCHAR 어느 유형을 지정하는지에 대한 문제가 자주 논의 됨
>
> 저장 영역
>
> VARCHAR 은 가변 길이이기 때문에 다양한 칼럼과, 정의된 길이와 실제 데이터 길이에 차이가 있는 칼럼에 적합 / 저장 측면에서도 CHAR 유형보다 작은 영역에 저장할 수 있어 장점
>
> 문자열의 비교 방법
>
> VARCHAR 는 공백도 하나의 문자로 취급함 / CHAR 는 끝의 공백만 다른 문자열은 같다고 판단함

> 고정된 길이의 문자열을 가지지 않는다면 VARCHAR 유형이 바람직

## 2. CREATE TABLE

> 해당 테이블에 입력될 데이터를 정의
>
> 정의한 데이터를 어떠한 유형으로 선언할 것인지

1. ##### 테이블과 칼럼 정의

   > 칼럼 중 하나를 지정해 PK 칼럼으로 지정
   >
   > ​	여러 개의 칼럼이 될 수 있음
   >
   > 테이블과 테입르 간에 정의된 관계는 PK 와 FK 를 활용해 설정

2. ##### CREATE TABLE

   > 테이블 생성하는 구문 형식
   >
   > ```sql
   > CREATE TABLE 테이블이름 ( 칼럼명1 DATATYPE [DEFAULT 형식], 칼럼명2 DATATYPE [DEFAULT 형식], 칼럼명2 DATATYPE [DEFAULT 형식] ) ;
   > ```
   >
   > 테이블명은 객체를 의미할 수 있는 이름, 단수형 - 중복 X
   >
   > 한 테이블 내에서 칼럼명 중복 안 됨 (다른 테이블은 됨)
   >
   > 테이블명은 반드시 문자로 시작되어야 하고 특수 문자 안 됨

   > \- 테이블 생성시 대/소문자 구분은 하지 않는다. 기본적으로 테이블이나 칼럼명은 대문자로 만들어진다. - DATETIME 데이 터 유형에는 별도로 크기를 지정하지 않는다. - 문자 데이터 유형은 반드시 가질 수 있는 최대 길이를 표시해야 한다. - 칼럼 과 칼럼의 구분은 콤마로 하되, 마지막 칼럼은 콤마를 찍지 않는다. - 칼럼에 대한 제약조건이 있으면 CONSTRAINT를 이용 하여 추가할 수 있다.
   >
   > 제약조건은 PLAYER_NAME, TEAM_ID 칼럼의 데이터 유형 뒤에 NOT NULL을 정의한 사례와 같은 칼럼 LEVEL 정의 방식 과, PLAYER_PK PRIMARY KEY, PLAYER_FK FOREIGN KEY 사례처럼 테이블 생성 마지막에 모든 제약조건을 기술하는 테이블 LEVEL 정의 방식이 있다. 하나의 SQL 문장 내에서 두 가지 방식은 혼용해서 사용할 수 있으며, 같은 기능을 가지고 있다.

3. ##### 제약조건 (CONSTRAINT)

   > 사용자가 원하는 조건의 데이터만 유지하기 위한 즉, 데이터의 무결성을 유지하기 위한 데이 터베이스의 보편적인 방법으로 테이블의 특정 칼럼에 설정하는 제약

   | 구분        | 설명                                                         |
   | ----------- | ------------------------------------------------------------ |
   | PRIMARY KEY | 하나의 테이블에 하나의 기본키 제약만 정의 가능<br />기본키 제약을 정의하면 DBMS 는 자동으로 UNIQUE 인덱스 생성, 기본키를 구성하는 칼럼에는 NULL 을 입력할 수 없다.<br />결국 `기본키 제약 = 고유키 제약 & NOT NULL 제약` 이 된다. |
   | UNIQUE KEY  | 테이블에 저장된 행 데이터를 고유하게 식별하기 위한 고유키를 정의<br />단, NULL 은 고유키 제약의 대상이 아니므로, NULL 값을 가진 행이 여러 개가 있더라도 고유키 제약 위반이 되지 않음 |
   | NOT NULL    |                                                              |
   | CHECK       | 입력할 수 있는 값의 범위 등을 제한<br />CHECK 제약으로는 TURE or FALSE 로 평가할 수 있는 논리식 지정 |
   | FOREIGN KEY | 기본키를 다른 테이블의 외래키로 복사하는 경우<br />참조 무결성 제약 옵션을 선택할 수 있음 |

4. ##### 생성된 테이블 구조 확인

5. ##### SELECT 문장을 통한 테이블 생성 사례 (CTAS: Create Table ~ As Select ~)

   > 장점: 칼럼별로 데이터 유형을 다시 재정의 하지 않아도 됨
   >
   > 주의: 제약조건 NOT NULL 만 새로운 복제 테이블에 적용되고, 다른 제약조건은 없어짐
   >
   > 제약 조건을 추가하기 위해서는 ALTER TABLE 기능

## 3. ALTER TABLE

> 테이블 구조 변경할 일이 생김

1. ##### ADD COLUMN

   > ```sql
   > ALTER TABLE 테이블명 ADD 추가할 칼럼명 데이터 유형;
   > ```
   >
   > 주의: 테이블의 마지막 칼럼이 되며 위치를 지정할 수는 없다.

2. ##### DROP COLUMN

   > ```sql
   > ALTER TABLE 테이블명 DROP COLUMN 삭제할 칼럼명;
   > ```
   >
   > 한 번에 하나 삭제 가능
   >
   > 삭제 후 최소 하나 이상 칼럼 존재해야 함
   >
   > 복구 불가

3. ##### MODIFY COLUMN

   > ```sql
   > # sql server
   > ALTER TABLE 테이블명 ALTER (칼럼명1 데이터 유형 [DEFAULT 식] [NOT NULL], 칼럼명2 데이터 유형 ...);
   > ```
   >
   > ```sql
   > # oracle
   > ALTER TABLE 테이블명 MODIFY (칼럼명1 데이터 유형 [DEFAULT 식] [NOT NULL], 칼럼명2 데이터 유형 ...);
   > ```
   >
   > 칼럼 크기 늘릴 수는 있지만, 줄일 수는 없음
   >
   > 해당 칼럼이 NULL 값만 있거나 테이블에 아무 행도 없으면 칼럼의 폭을 줄일 수 있다.
   >
   > 해당 칼럼이 NULL 값만을 가지고 있으면 데 이터 유형을 변경할 수 있다.
   >
   > 해당 칼럼의 DEFAULT 값을 바꾸면 변경 작업 이후 발생하는 행 삽입에만 영향을 미치게 된 다.
   >
   > 해당 칼럼에 NULL 값이 없을 경우에만 NOT NULL 제약조건을 추가할 수 있다.

4. ##### DROP CONSTRAINT

   > ```sql
   > ALTER TABLE 테이블명 DROP CONSTRAINT 제약조건명;
   > ```

5. ##### ADD CONSTRAINT

   > ```sql
   > ALTER TABLE 테이블명 ADD CONSTRAINT 제약조건명 제약조건 (칼럼명);
   > ```

   > 테이블 생성 이후 제약조건 추가
   >
   > 참조 무결성 옵션에 따라서 만약 TEAM 테이블이나 TEAM 테이블의 데이터를 삭제하려 할 경우 외부(PLAY ER 테이블)에서 참조되고 있기 때문에 삭제가 불가능하게 제약을 할 수 있다. 즉, 외부키(FK)를 설정함으로써 실수에 의한 테이블 삭제나 필요한 데이터의 의도하지 않은 삭제와 같은 불상사를 방지하는 효과를 볼 수 있다.

## 4. RENAME TABLE

> ```sql
> RENAME 변경전테이블명 TO 변경후테이블명;
> ```
>
> ```sql
> # sql server
> sp_rename 변경전 테이블명, 변경후 테이블명;
> ```

## 5. DROP TABLE

> ```sql
> DROP TABLE 테이블명 [CASCADE CONSTRAINT];
> ```
>
> CASCADE CONSTRAINT 옵션은 해당 테이블 과 관계가 있었던 참조되는 제약조건에 대해서도 삭제한다는 것
>
> SQL Server에서는 CASCADE 옵션이 존재하지 않으며 테이블을 삭제하기 전에 참조하는 FOREIGN KEY 제약 조건 또는 참조하는 테이블을 먼저 삭제해 야 한다.

## 6. TRUNCATE TABLE

> ```sql
> TRUNCATE TABLE PLAYER;
> ```
>
> 해당 테이블에 들어있던 모든 행들이 제거되고 저장 공 간을 재사용 가능하도록 해제